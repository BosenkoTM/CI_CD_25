# Лабораторная работа №1. Установка и настройка Docker. Работа с контейнерами в Docker

## Цель работы
Освоить процесс установки и настройки Docker, научиться работать с основными командами CLI, контейнерами и образами. Понять принципы контейнеризации для развертывания аналитических сред и сервисов.

## Необходимые инструменты и технологии
Для выполнения работы потребуются:
*   **Платформа виртуализации:** VirtualBox (для запуска виртуальной машины).
*   **Виртуальная машина (Образ):** `dev_kub_student.ova` (Ubuntu-based).  
    *   [Ссылка для скачивания образа](https://envlab.ru/mod/folder/view.php?id=1078)
*   **ПО:** Docker CE (Community Edition), Docker CLI.
*   **Система контроля версий:** Git.
*   **Хостинг репозиториев:** GitHub или GitVerse.

## Задачи
-  Развернуть виртуальную машину из образа `dev_kub_student.ova`.
-  Установить Docker в среде виртуальной машины (или проверить наличие/обновить).
-  Проверить корректность установки Docker.
-  Ознакомиться с основными командами Docker CLI (работа с образами, запуск, остановка, логи).
-  Выполнить индивидуальное задание согласно варианту.
-  Оформить отчет и загрузить его в репозиторий.

## Критерии оценки (Всего 10 баллов)
| Критерий | Баллы | Описание |
| :--- | :---: | :--- |
| **Корректность установки** | 2 | Docker установлен, сервис активен, пользователь добавлен в группу docker. |
| **Работа с CLI** | 3 | Выполнены базовые команды (`run`, `ps`, `images`), приведены скриншоты. |
| **Индивидуальное задание** | 5 | Контейнер по варианту запущен, настроен (порты/env), функциональность проверена. |

---

## Ход работы

### Шаг 0. Подготовка среды
-  Скачайте образ `dev_kub_student.ova`.
-  Импортируйте его в VirtualBox.
-  Запустите виртуальную машину. Весь дальнейший ход работы выполняется в терминале этой ВМ.

### Шаг 1. Установка Docker
*(Пример команд для Ubuntu 20.04/22.04, используемой в образе)*

Откройте терминал и выполните обновление пакетов и установку зависимостей:

```bash
sudo apt update
sudo apt install apt-transport-https ca-certificates curl gnupg lsb-release
```

Добавьте официальный GPG-ключ Docker:
```bash
curl -fsSL https://download.docker.com/linux/ubuntu/gpg | sudo gpg --dearmor -o /usr/share/keyrings/docker-archive-keyring.gpg
```

Настройте стабильный репозиторий:
```bash
echo "deb [arch=amd64 signed-by=/usr/share/keyrings/docker-archive-keyring.gpg] https://download.docker.com/linux/ubuntu $(lsb_release -cs) stable" | sudo tee /etc/apt/sources.list.d/docker.list > /dev/null
```

Установите Docker Engine:
```bash
sudo apt update
sudo apt install docker-ce docker-ce-cli containerd.io
```

**Важно.** Добавьте текущего пользователя в группу `docker`, чтобы выполнять команды без `sudo`:
```bash
sudo usermod -aG docker $USER
newgrp docker
```

### Шаг 2. Проверка установки
Убедитесь, что Docker установлен корректно:

```bash
docker --version
# Вывод должен содержать версию, например: Docker version 24.0.5...
```

Запустите тестовый контейнер:
```bash
docker run hello-world
# Вы должны увидеть сообщение: "Hello from Docker! This message shows that your installation appears to be working correctly."
```

### Шаг 3. Знакомство с командами Docker CLI
Выполните следующие команды и зафиксируйте результат (скриншоты):

1.  Просмотр скачанных образов:
    ```bash
    docker images
    ```
2.  Просмотр запущенных контейнеров:
    ```bash
    docker ps
    ```
3.  Просмотр всех контейнеров (включая остановленные):
    ```bash
    docker ps -a
    ```

### Шаг 4. Пример выполнения задания (Вариант 25 — SonarQube)
*Этот пример демонстрирует ожидаемый уровень выполнения индивидуального задания.*

-  Загрузка образа:
    ```bash
    docker pull sonarqube
    ```
-  Запуск контейнера с пробросом портов (HostPort:ContainerPort):
    ```bash
    docker run -d --name sonarqube -p 9000:9000 -p 9092:9092 sonarqube
    ```
-  Проверка работы:
    *   Откройте браузер внутри ВМ или на хосте (если сеть настроена) по адресу `http://localhost:9000`.
    *   Дождитесь загрузки SonarQube.
    *   Логин/пароль по умолчанию: `admin` / `admin`.
    *   Смените пароль при запросе.
    *   Создайте пустой проект ("Create new project").
-  Очистка ресурсов:
    ```bash
    docker stop sonarqube
    docker rm sonarqube
    ```

---

## Индивидуальные задания

Выберите вариант согласно списку группы или указанию преподавателя.

> **Обратите внимание.** Для некоторых аналитических систем (Jupyter, ClickHouse, Metabase) загрузка образа может занять чуть больше времени из-за их размера.

| Вариант | Образ | Задание |
| :---: | :--- | :--- |
| **1** | `nginx` | **Веб-сервер для отчетов.** Запустить контейнер, настроить проброс портов (8080:80) и проверить доступность стартовой страницы в браузере. |
| **2** | `mysql` | **Реляционная БД.** Запустить контейнер, задать пароль root через переменную `MYSQL_ROOT_PASSWORD`. Подключиться к БД из терминала контейнера и создать тестовую базу данных `sales`. |
| **3** | `python` | **Скриптинг.** Запустить контейнер, создать внутри простой файл `script.py` (выводящий "Hello Data Analysis"), выполнить его и получить результат в консоли. |
| **4** | `httpd` | **Хостинг документации.** Запустить контейнер Apache, смонтировать локальную папку с простым HTML-отчетом внутрь контейнера и проверить его отображение в браузере. |
| **5** | `redis` | **Кэширование/NoSQL.** Запустить контейнер, подключиться через `redis-cli` и создать несколько ключей (например, `user:1`, `user:2`) для имитации кэша сессий пользователей. |
| **6** | `jupyter/base-notebook` | **Data Science среда.** Запустить контейнер с Jupyter Notebook, пробросить порт 8888. Скопировать токен из логов консоли и зайти в интерфейс создания ноутбуков. |
| **7** | `postgres` | **Реляционная БД.** Запустить контейнер, настроить переменную `POSTGRES_PASSWORD`. Подключиться через `psql` и создать таблицу `analytics_data` с парой полей. |
| **8** | `mongo` | **Документоориентированная БД.** Запустить контейнер, зайти в оболочку `mongosh` (или `mongo`) и создать коллекцию `products` с одним JSON-документом. |
| **9** | `clickhouse/clickhouse-server` | **Аналитическая БД.** Запустить ClickHouse (популярен в Big Data). Подключиться через `clickhouse-client` внутри контейнера и выполнить запрос `SELECT 1`. |
| **10** | `elasticsearch` | **Поисковый движок.** Запустить контейнер (в режиме `discovery.type=single-node`), проверить работоспособность, отправив GET-запрос через `curl` на порт 9200 (получить JSON с версией). |
| **11** | `kibana` | **Визуализация данных.** Запустить контейнер, связать его с запущенным Elasticsearch (или просто проверить запуск веб-интерфейса на порту 5601), изучить меню. |
| **12** | `grafana/grafana` | **Дашборды.** Запустить контейнер, открыть веб-интерфейс (порт 3000), зайти под admin/admin. Изучить раздел добавления источников данных (Data Sources). |
| **13** | `metabase/metabase` | **BI-система.** Запустить контейнер, дождаться инициализации. Открыть веб-интерфейс (порт 3000) и пройти шаг начальной настройки "Welcome to Metabase". |
| **14** | `adminer` | **Управление БД.** Легковесный интерфейс для баз данных. Запустить контейнер, открыть в браузере (порт 8080) и попробовать интерфейс подключения (форма логина). |
| **15** | `wordpress` | **CMS (Контент-аналитика).** Запустить контейнер. Проверить доступность страницы установки. (Опционально: подключить к внешней БД, если есть навыки, или просто проверить запуск сервиса). |
| **16** | `mariadb` | **Реляционная БД.** Аналог MySQL. Запустить контейнер, установить переменную пароля root, зайти в БД и создать пользователя `analyst`. |
| **17** | `minio/minio` | **S3 Хранилище (Data Lake).** Запустить контейнер командой server /data. Настроить доступ в консоль, зайти в веб-интерфейс и создать "бакет" (bucket) для файлов. |
| **18** | `influxdb` | **БД временных рядов.** Используется для IoT и метрик. Запустить контейнер, зайти в веб-интерфейс (порт 8086) и создать первичного пользователя/организацию. |
| **19** | `odoo` | **ERP/CRM система.** Запустить контейнер (потребует настройки связи с Postgres или просто запуска веб-интерфейса для проверки доступности на порту 8069). Полезно для понимания бизнес-процессов. |
| **20** | `node` | **Веб-приложение.** Запустить контейнер, войти в интерактивный режим (`node`) и выполнить простую математическую операцию или команду `console.log`. |
| **21** | `ghost` | **Платформа для блогов.** Используется для публикации корпоративных блогов/отчетов. Запустить контейнер, проверить доступность админ-панели (порт 2368). |
| **22** | `memcached` | **Кэширование.** Простой сервис кэширования. Запустить контейнер, подключиться через `telnet` (если есть) или просто проверить статус контейнера и логи о готовности к работе. |
| **23** | `registry` | **Docker Registry.** Локальный репозиторий образов. Запустить контейнер на порту 5000. Полезно для понимания, где хранятся образы в компании. |
| **24** | `portainer/portainer-ce` | **Управление Docker.** Графический интерфейс для управления контейнерами. Запустить, создать пароль администратора и просмотреть список локальных контейнеров через UI. |
| **25** | `sonarqube` | **Качество кода.** (Как в примере). Запустить контейнер, зайти в интерфейс, сменить пароль и создать пустой проект. |

---

## Требования к отчетности

Все работы загружаются в репозиторий на **GitHub** или **GitVerse**.

### Структура репозитория:
1.  Создайте репозиторий, например: `analytics-docker-labs`.
2.  Для данной работы создайте папку: `lab_01`.
3.  В папке должен находиться файл отчета `REPORT.md` (или `README.md`) и папка `img` со скриншотами.

### Содержание отчета (`REPORT.md`):
-  **Титульный лист** (Текстовый блок. ФИО, группа, название работы, вариант).
-  **Цель работы**.
-  **Ход выполнения работы**:
    *   Описание шагов установки (кратко).
    *   **Скриншоты** успешного выполнения команд `docker version`, `docker run hello-world`.
    *   **Скриншоты** выполнения команд CLI (`ps`, `images`).
    *   **Подробное описание выполнения индивидуального задания**:
        *   Команда запуска контейнера (текстом).
        *   Скриншот работающего контейнера (`docker ps`).
        *   Скриншот результата работы (веб-страница в браузере, ответ базы данных в консоли и т.д.).
-  **Выводы**. Что изучено, с какими проблемами столкнулись.
-  **Ответы на контрольные вопросы**.

---

## Контрольные вопросы
1.  Что такое Docker и для чего он используется в задачах аналитики данных?
2.  Какие преимущества дает использование контейнеров Docker по сравнению с классическими виртуальными машинами?
3.  Что такое образ Docker (Image) и как он связан с контейнерами?
4.  Перечислите основные команды Docker CLI, использованные в работе, и их назначение.
5.  Как настроить маршрутизацию портов (port mapping) при запуске контейнера и зачем это нужно?

```
