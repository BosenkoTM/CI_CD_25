# Урок 10. Развертывание приложения в Kubernetes

## Введение в развертывания и сервисы

В этом уроке вы узнаете, как развернуть простое приложение в Kubernetes с помощью **Развертывания** и запустить его как **Сервис**. В качестве приложения мы будем использовать базовый веб-сервер Nginx. К концу этого урока вы поймете концепции Pod, Deployments и Services в Kubernetes.

## Что такое Pod, Deployments и Services?

- **Pod**: наименьшая развертываемая единица в Kubernetes. Pod может содержать один или несколько контейнеров, которые совместно используют одно и то же сетевое пространство имен и хранилище. Pod являются эфемерными и могут быть созданы, уничтожены или реплицированы на основе желаемого состояния, определенного пользователем.

- **Deployment**: абстракция более высокого уровня, которая управляет набором идентичных Pod. Он обеспечивает запуск нужного количества Pod и может беспрепятственно обрабатывать обновления приложения.

- **Сервис**: абстракция, которая определяет логический набор Pod и политику доступа к ним. Сервисы обеспечивают связь между различными частями вашего приложения и предоставляют стабильные конечные точки для доступа к Pod.

## Шаг 1. Создание простого развертывания

1. **Откройте свой терминал**: Убедитесь, что вы подключены к кластеру Kubernetes.

2. **Создайте развертывание**: Используйте следующую команду для создания развертывания, которое запускает веб-сервер Nginx:

```bash
kubectl create deployment nginx-deployment --image=nginx
```

Эта команда создает развертывание с именем `nginx-deployment`, используя официальный образ Nginx.

3. **Проверьте развертывание**: чтобы проверить состояние развертывания и увидеть созданные им модули, выполните:

```bash
kubectl get deployments
```

Вы должны увидеть вывод, указывающий на то, что `nginx-deployment` запущен.

4. **Список модулей**: чтобы увидеть созданные развертыванием модули, используйте:

```bash
kubectl get pods
```

Вы должны увидеть один или несколько модулей с именами, начинающимися с `nginx-deployment`.

## Шаг 2. Установите развертывание как службу

Теперь, когда у вас запущено развертывание, вы можете предоставить его как службу, чтобы сделать его доступным извне кластера.

1. **Открыть развертывание**: выполните следующую команду, чтобы создать службу, которая открывает развертывание Nginx:

```bash
kubectl expose deployment nginx-deployment --type=NodePort --port=80
```

- Параметр `--type=NodePort` открывает службу на статическом порту на каждом узле в кластере.
- Параметр `--port=80` указывает, что служба будет прослушивать порт 80.

2. **Проверка службы**: чтобы проверить состояние службы, используйте:

```bash
kubectl get services
```

Вы должны увидеть службу с именем `nginx-deployment` с назначенным `NodePort`.

3. **Получить NodePort**: чтобы узнать, какой порт был назначен, найдите столбец `PORT(S)` в выводе предыдущей команды. Он будет выглядеть примерно так: `80:<NodePort>/TCP`.

## Шаг 3. Доступ к приложению Nginx

1. **Получить IP-адрес узла**: Для доступа к приложению Nginx вам понадобится IP-адрес одного из узлов в вашем кластере. Если вы используете Minikube, вы можете получить IP-адрес, запустив:

```bash
minikube ip
```

Если вы используете Docker Desktop, вы можете получить доступ к приложению, используя `localhost`.

2. **Получить доступ к приложению**: Откройте веб-браузер и перейдите по адресу `http://<Node-IP>:<NodePort>`. Замените `<Node-IP>` на полученный вами IP-адрес, а `<NodePort>` на номер порта из службы.

Вы должны увидеть страницу приветствия Nginx, указывающую на то, что ваше приложение успешно запущено.

## Шаг 4. Очистка ресурсов

После тестирования приложения вы можете очистить созданные вами ресурсы.

1. **Удалите службу**:

```bash
kubectl delete service nginx-deployment
```

2. **Удалите развертывание**:

```bash
kubectl delete deployment nginx-deployment
```

3. **Проверка удаления**: Чтобы убедиться, что ресурсы удалены, вы можете запустить:

```bash
kubectl get deployments
kubectl get services
```

Вы не должны увидеть никаких ресурсов, перечисленных для `nginx-deployment`.

## Заключение

В этом уроке вы узнали, как развернуть простое приложение в Kubernetes с помощью развертывания и предоставить его в качестве службы. Вы изучили концепции Pods, Deployments и Services, получив практический опыт работы с Kubernetes. На следующем уроке мы углубимся в масштабирование приложений и управление обновлениями в Kubernetes.



### Контрольные вопросы.
1. Что такое Pod, Deployment и Service в Kubernetes?
2. Каково назначение Deployment в Kubernetes?
3. Каково назначение Service в Kubernetes?
4. Как создать Deployment в Kubernetes?
5. Как создать Service в Kubernetes и какие типы Services существуют?

